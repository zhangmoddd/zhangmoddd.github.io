<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>带歌词的音乐播放器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

        * { box-sizing: border-box; }

        body {
            background-image: linear-gradient(0deg, #d9afd9 0%, #97d9e1 100%);
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; /* 防止页面整体滚动 */
        }

        .music-container {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 20px 20px 0 rgba(132, 132, 132, 0.3);
            display: flex;
            padding: 20px 30px;
            position: relative;
            z-index: 10;
            width: 380px; /*稍微宽一点容纳歌词*/
            flex-direction: column;
            align-items: center;
            max-height: 90vh; /* 限制最大高度 */
        }

        .img-container {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-top: -60px;
            margin-bottom: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            position: relative;
        }

        .img-container img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            animation: rotate 10s linear infinite;
            animation-play-state: paused;
        }

        .music-container.play .img-container img {
            animation-play-state: running;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        h2 { margin: 0; font-size: 18px; text-align: center; }
        h3 { margin: 5px 0 15px; font-size: 12px; color: #777; text-align: center; }

        /* --- 歌词区域样式 --- */
        .lyrics-box {
            height: 120px; /* 歌词显示高度 */
            width: 100%;
            overflow-y: auto; /* 允许滚动 */
            text-align: center;
            margin-bottom: 20px;
            padding: 0 10px;
            position: relative;
            /* 隐藏滚动条但保留功能 */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* IE */
        }
        .lyrics-box::-webkit-scrollbar { 
            display: none; /* Chrome/Safari */ 
        }

        .lyrics-box ul {
            padding: 0;
            margin: 0;
            list-style: none;
            transition: transform 0.3s ease-out;
        }

        .lyrics-box li {
            font-size: 12px;
            color: #aaa;
            line-height: 24px;
            transition: all 0.3s ease;
            min-height: 24px; /* 防止空行高度塌陷 */
        }

        .lyrics-box li.active {
            color: #fe8daa; /* 高亮颜色 */
            font-size: 15px;
            font-weight: bold;
            transform: scale(1.05);
        }

        .navigation {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-bottom: 15px;
        }

        .action-btn {
            background-color: #fff;
            border: 0;
            color: #dfdbdf;
            font-size: 20px;
            cursor: pointer;
            padding: 10px;
            margin: 0 15px;
        }
        .action-btn:hover { color: #cdc2d0; }
        .action-btn-big { color: #cdc2d0; font-size: 30px; }
        .action-btn-big:hover { color: #97d9e1; }

        .progress-container {
            background: #eee;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
            height: 6px;
            width: 100%;
        }

        .progress {
            background-color: #fe8daa;
            border-radius: 5px;
            height: 100%;
            width: 0%;
            transition: width 0.1s linear;
        }

        .playlist {
            width: 100%;
            max-height: 100px;
            overflow-y: auto;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        .playlist p {
            font-size: 11px;
            padding: 4px;
            margin: 0;
            cursor: pointer;
            color: #555;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .playlist p:hover { background-color: #f0f0f0; }
        .playlist p.active { color: #fe8daa; font-weight: bold; }

    </style>
</head>
<body>

    <div class="music-container" id="music-container">
        <div class="img-container">
            <img src="https://via.placeholder.com/150" alt="cover" id="cover">
        </div>

        <h2 id="title">歌曲标题</h2>
        <h3 id="artist">歌手</h3>

        <!-- 歌词显示区域 -->
        <div class="lyrics-box" id="lyrics-box">
            <ul id="lyrics-list"></ul>
        </div>

        <audio id="audio" src=""></audio>

        <div class="progress-container" id="progress-container">
            <div class="progress" id="progress"></div>
        </div>

        <div class="navigation">
            <button id="prev" class="action-btn"><i class="fas fa-backward"></i></button>
            <button id="play" class="action-btn action-btn-big"><i class="fas fa-play"></i></button>
            <button id="next" class="action-btn"><i class="fas fa-forward"></i></button>
        </div>
        
        <div class="playlist" id="playlist-view"></div>
    </div>

    <script>
        // ================= 配置区域 =================
        /* 
           如何获取 LRC 歌词：
           1. 在网易云/QQ音乐下载歌词，或者去网上搜 "歌曲名 lrc"。
           2. 用记事本打开 .lrc 文件。
           3. 全选复制文本。
           4. 粘贴到下方对应歌曲的 lrc: `这里` 引号中。
           5. 注意：必须保留 [00:12.34] 这种时间标签。
        */
        const songs = [
            {
                title: "一样的月光", // 示例
                artist: "徐佳莹",
                path: "music/一样的月光.mp3",  // 记得改这里
                cover: "images/一样的月光.jpg", 
                // 下面是示例歌词，请替换成你自己的
                lrc: `[00:15.96] 倔强的表情 就这样隔离了我们想触摸的脸庞
[00:25.68] 不再体贴退让
[00:30.06] 沉默的对话 就这样取代了我们想聆听的愿望
[00:39.65] 不再交换悲伤
[00:44.03] 太自以为的世界
[00:50.14] 被你离开的反作用力 锁进黑暗陷阱
[00:59.50] 一样的月光 怎么看得我越来越心慌
[01:05.58] 你留下最清楚的步伐 竟是指引我孤单的方向
[01:13.04] 一样的月光 怎么照不亮未来的形状
[01:19.69] 喔 就这样吧 我的爱 让寂寞的月光占据我的窗
[01:33.62] 
[01:41.23] 自由的路况 就这样阻挡了我们想超速的逃亡
[01:52.08] 不再戒慎紧张
[01:56.41] 独处的时光 就这样取代了我们想搜集的拥抱
[02:06.26] 不再殷切需要
[02:10.45] 太多理智的世界
[02:16.66] 被你离开的反作用力 锁进黑暗陷阱
[02:26.12] 一样的月光 怎么看得我越来越心慌
[02:31.96] 你留下最清楚的步伐 竟是指引我孤单的方向
[02:40.03] 一样的月光 怎么照不亮未来的形状
[02:46.02] 喔 就这样吧 我的爱 让寂寞的月光占据我的窗
[03:07.34] 一样的月光 其实看得我越来越心慌
[03:14.70] 怎么你留下最真实的回忆 都是提醒我失去的声音
[03:22.50] 一样的月光 已经照不亮未来的形状
[03:28.81] 喔 能回来吗 我的爱 让疯狂的爱情占据我的窗
[03:40.70]
`
            },
            {
                title: "爱情讯息",
                artist: "郭静",
                path: "music/爱情讯息.mp3",
                cover: "images/爱情讯息.jpg",
                lrc: `[00:00.00] 作曲 : 陈科妤
[00:01.00] 作词 : 陈宥毓
[00:31.29]那又怎样 让自己习惯这个频率
[00:37.69]或许是吧 爱情不是个完美旋律
[00:44.07]如果可以 偶尔任性应该也没关系
[00:50.50]心情也会下起大雨不会太美丽啊
[00:56.74]
[00:56.90]那就追吧 不要让自己放弃决定
[01:03.16]每次相遇
[01:06.00]都会有一种让人感动的美丽
[01:11.17]每天一张开眼睛就会想到你
[01:16.01]想知道 在窗外的雨滴
[01:19.75]写些什么秘密
[01:22.78]
[01:23.71]想念变成空气在叹息
[01:26.93]多么想要躺在你怀里
[01:30.08]那是爱情
[01:31.15]带来的讯息让自己傻的很确定
[01:36.42]想念变成空气在叹息
[01:39.43]拥抱心中最真的感应 调整呼吸
[01:43.91]写着不管多少时间我都会等你
[01:50.95]啊~
[01:55.70]
[02:00.60]
[02:00.86]不管怎样
[02:03.60]虽然人们总说爱情会很受伤
[02:10.04]但我想 我会让自己更坚强吧
[02:15.20]每天起床都让心情不会慌张
[02:20.00]想让流星能够实现 幸福的愿望
[02:26.78]
[02:27.63]想念变成空气在叹息
[02:30.72]多么想要躺在你怀里
[02:33.90]那是爱情带来的讯息
[02:36.80]让自己傻的很确定
[02:40.42]爱情总是不能被预期
[02:43.47]需要勇气来面对决心
[02:46.64]调整呼吸 写下
[02:48.80]不管多少时间我会等你
[02:53.33]
[02:53.59]相信 要相信
[02:56.04]幸福它终将会越靠越近
[02:59.51]恋爱的人总害怕听见寂寞的声音
[03:05.85]每次假装遇见你
[03:08.97]总想像能够有浪漫的乐章
[03:18.26]
[03:18.93]想念变成空气在叹息
[03:21.88]多么想要躺在你怀里
[03:25.03]那是爱情带来的讯息
[03:28.20]让自己傻的很确定
[03:31.66]想念变成空气在叹息
[03:34.69]拥抱心中最真的感应
[03:37.94]调整呼吸 写着
[03:39.94]不管多少时间我会等你
[03:44.40]
[03:44.47]想念变成空气在叹息
[03:47.48]多么想要躺在你怀里
[03:50.66]那是爱情带来的讯息
[03:53.80]让自己傻的很确定
[03:57.08]爱情总是不能被预期
[04:00.40]需要勇气来面对决心
[04:03.73]调整呼吸 写下
[04:06.03]不管多少时间我会等你
[04:11.27]
[04:35.16]` //    如果没有歌词，可以留空或写这个
            },
            {
                title: "Mystical Magical",
                artist: "Benson Boone",
                path: "music/Mystical Magical.mp3",
                cover: "images/Mystical Magical.jpg",
                lrc: `[00:07.63] There's nothing colder
[00:08.96] Than your shoulder
[00:09.75] When you're dragging me along
[00:11.69] Like you do, like you do
[00:15.42] And then you switch up
[00:16.56] With no warning
[00:17.77] And you kiss me like you want it
[00:19.55] How rude, how rude
[00:22.76] But I kinda like it anyways
[00:25.70] I don't mind
[00:26.57] If this is gonna take a million days
[00:29.54] I know you'll come around
[00:31.41] To me eventually
[00:33.57] If you sit back, relax
[00:35.66] Enjoy my company
[00:37.83] My company
[00:39.81] Once you know
[00:41.65] What my love's gonna feel like
[00:44.11] Nothing else
[00:45.07] Will feel right
[00:46.31] You can feel like
[00:47.96] Moonbeam ice cream
[00:50.08] Taking off your blue jeans
[00:52.19] Dancing at the movies
[00:54.38] 'Cause it feels
[00:55.41] So mystical
[00:57.34] Magical oh baby
[00:59.52] 'Cause once you know
[01:01.11] Once you know
[01:02.58] My love is
[01:03.61] So mystical, magical
[01:06.46] Oh baby!
[01:07.76] 'Cause once you know
[01:09.15] Once you know
[01:12.36] My little hard-to-get baby
[01:14.29] I want to give you the world
[01:16.43] Not saying you gotta chase me
[01:18.23] But I wouldn't mind it
[01:20.04] If you gave me just a little bit of
[01:22.09] Something we can work it with
[01:24.04] But all you do is push me out
[01:27.61] But I like it anyways
[01:29.63] 'Cause I think
[01:30.54] I'm getting closer to you everyday
[01:33.79] I know you'll come around
[01:35.38] To me eventually
[01:37.76] Just sit back, relax
[01:39.60] Enjoy my company
[01:42.14] Oh baby! Trust me
[01:44.18] Once you know
[01:45.66] What my love's gonna feel like
[01:48.15] Nothing else will feel right
[01:50.44] You can feel like
[01:52.06] Moonbeam ice cream
[01:53.94] Taking off your blue jeans
[01:56.11] Dancing at the movies
[01:58.37] 'Cause it feels
[01:59.28] So mystical, magical
[02:02.52] Oh baby!
[02:03.68] 'Cause, once you know
[02:05.26] Once you know
[02:06.51] My love is
[02:07.54] So mystical, magical
[02:10.31] Oh baby!
[02:11.68] 'Cause once you know
[02:13.60] Once you know
[02:16.69] Once you know what my love's going to feel like
[02:21.50] 
[02:24.49] Moonbeam ice cream
[02:26.12] Nothing else will feel right
[02:29.71] 
[02:32.04] Mystical, magical oh baby
[02:35.89] It's mystical, magical
[02:38.94] `// 如果没有歌词，可以留空或写这个
            },
            {
                title: "Don't Stop the Music",
                artist: "Rihanna",
                path: "music/Don't Stop the Music.mp3",
                cover: "images/Don't Stop the Music.jpg",
                lrc: `[00:00.06] Please don't stop the music (music, music, music, music)
[00:07.58] Please don't stop the music (music, music, music, music)
[00:15.59] Please don't stop the music (music, music, music, music)
[00:23.37] Please don't stop the music (music, music, music, music)
[00:31.70] It's gettin' late, I'm making my way over to my favorite place
[00:37.43] I gotta get my body moving, shake the stress away
[00:41.31] I wasn't looking for nobody when you looked my way
[00:45.11] Possible candidate, yeah
[00:47.88] Who knew that you'd be up in here lookin' like you do?
[00:53.30] You're making stayin' over here impossible
[00:57.05] Baby, I'ma say your aura is incredible
[01:00.85] If you don't have to go, don't
[01:03.75] Do you know what you started? I just came here to party
[01:07.45] But now we're rockin' on the dance floor, actin' naughty
[01:11.58] Your hands around my waist, just let the music play
[01:15.52] We're hand in hand, chest to chest, and now we're face to face
[01:19.02] I wanna take you away
[01:21.43] Let's escape into the music, DJ, let it play
[01:26.18] I just can't refuse it, like the way you do this
[01:29.93] Keep on rockin' to it
[01:31.80] Please don't stop the, please don't stop the music
[01:34.72] I wanna take you away
[01:37.13] Let's escape into the music, DJ, let it play
[01:41.58] I just can't refuse it, like the way you do this
[01:45.67] Keep on rockin' to it
[01:47.45] Please don't stop the, please don't stop the, please don't stop the music
[01:52.29] Baby, are you ready? 'Cause it's getting close
[01:56.33] Don't you feel the passion ready to explode?
[02:00.37] What goes on between us, no one has to know
[02:03.56] This is a private show, oh
[02:06.45] Do you know what you started? I just came here to party
[02:10.33] But now we're rockin' on the dance floor, actin' naughty
[02:14.05] Your hands around my waist, just let the music play
[02:17.94] We're hand in hand, chest to chest, and now, we're face to face
[02:21.60] I wanna take you away
[02:24.17] Let's escape into the music, DJ, let it play
[02:28.77] I just can't refuse it, like the way you do this
[02:32.31] Keep on rockin' to it
[02:34.38] Please don't stop the, please don't stop the music
[02:37.35] I wanna take you away
[02:39.71] Let's escape into the music, DJ, let it play
[02:44.13] I just can't refuse it, like the way you do this
[02:48.11] Keep on rockin' to it
[02:50.07] Please don't stop the, please don't stop the, please don't stop the music
[02:52.79] Mama-say, mama-sa, ma-ma-ko-ssa
[02:54.69] Mama-say, mama-sa, ma-ma-ko-ssa
[02:56.49] Mama-say, mama-sa, ma-ma-ko-ssa
[02:58.72] Mama-say, mama-sa, ma-ma-ko-ssa
[02:59.93] Please don't stop the music
[03:00.68] Mama-say, mama-sa, ma-ma-ko-ssa
[03:02.65] Mama-say, mama-sa, ma-ma-ko-ssa
[03:04.54] Mama-say, mama-sa, ma-ma-ko-ssa
[03:06.50] Mama-say, mama-sa, ma-ma-ko-ssa
[03:07.79] Please don't stop the music (music, music, music, music)
[03:13.02] 
[03:15.42] Please don't stop the music (music, music, music, music)
[03:22.43] 
[03:24.48] I wanna take you away
[03:26.75] Let's escape into the music, DJ, let it play
[03:31.12] I just can't refuse it, like the way you do this
[03:35.01] Keep on rockin' to it
[03:37.02] Please don't stop the, please don't stop the music
[03:39.89] I wanna take you away
[03:42.57] Let's escape into the music, DJ, let it play
[03:46.95] I just can't refuse it, like the way you do this
[03:50.54] Keep on rockin' to it
[03:52.71] Please don't stop the, please don't stop the, please don't stop the music
[03:55.35] Mama-say, mama-sa, ma-ma-ko-ssa
[03:57.10] Mama-say, mama-sa, ma-ma-ko-ssa
[03:59.08] Mama-say, mama-sa, ma-ma-ko-ssa
[04:01.16] Mama-say, mama-sa, ma-ma-ko-ssa
[04:02.38] Please don't stop the music
[04:03.24] Mama-say, mama-sa, ma-ma-ko-ssa
[04:05.18] Mama-say, mama-sa, ma-ma-ko-ssa
[04:07.12] Mama-say, mama-sa, ma-ma-ko-ssa
[04:09.05] Mama-say, mama-sa, ma-ma-ko-ssa
[04:10.26] Please don't stop the music
[04:11.01] Mama-say, mama-sa, ma-ma-ko-ssa
[04:12.95] Mama-say, mama-sa, ma-ma-ko-ssa
[04:14.75] Mama-say, mama-sa, ma-ma-ko-ssa
[04:16.93] Mama-say, mama-sa, ma-ma-ko-ssa
[04:17.98] Please don't stop the music (music, music, music, music)
[04:21.40] `// 如果没有歌词，可以留空或写这个
            },
            {
                title: "I Adore You",
                artist: "HUGEL / Topic / Arash / Daecolm",
                path: "music/I Adore You.mp3",
                cover: "images/I Adore You.jpg",
                lrc: `[00:00.01] (I adore you)
[00:02.12] Plenty more, plenty more
[00:04.01] But you're my hope for the night, oh
[00:06.23] Gimme more control
[00:08.35] Slow down for the night, oh
[00:10.10] Lemme know, lemme know
[00:12.02] That you're down for the vibe
[00:14.12] Are you down for the vibe? Oh
[00:16.25] We don't say bye-bye
[00:18.32] You can see my eyes
[00:20.17] That I'm on the rise, oh
[00:22.40] I believe body lies
[00:24.39] But your body be smilin' though (ay, ay)
[00:28.75] These are the nights I love
[00:32.38] 'Cause you know, baby, I adore you, I adore you
[00:37.69] Can't ignore you, can't ignore you, ah
[00:41.85] Body-ody, my soul and that, I'm outta control, I can't
[00:45.64] I adore you, I adore you, I do
[00:49.94] Plenty more, plenty more (plenty more, ay)
[00:52.24] But you're my hope for the night, oh
[00:54.34] Gimme more control (control)
[00:56.18] Slow down for the night, oh
[00:58.24] Lemme know, lemme know (lemme know)
[01:00.31] That you're down for the vibe
[01:02.47] Are you down for the vibe? Oh
[01:04.52] We don't say bye-bye
[01:06.02] Le-le-le, le-le-le, yeah, yeah
[01:09.94] Le-le-le, le-le-le, yeah, yeah
[01:13.96] Le-le-le, le-le-le, yeah
[01:17.37] Baby, I adore you, I adore you, I do
[01:22.99] She gon' keep it minimum, poco
[01:27.68] Pull you in and walk in like model
[01:31.02] She like Mona Lisa, oh majo (oh majo)
[01:35.02] Majo (oh majo), oh
[01:38.48] You can see my eyes
[01:40.38] That I'm on the rise, oh
[01:42.20] I believe body lies
[01:44.20] But your body be smilin' though (ay, ay)
[01:48.46] These are the nights I love
[01:52.33] 'Cause you know, baby, I adore you, I adore you
[01:57.46] Can't ignore you, can't ignore you, ah
[02:01.92] Body-ody, my soul and that, I'm outta control, I can't
[02:05.95] I adore you, I adore you
[02:08.95] (Ooh, baby) baby, I adore you, I adore you
[02:13.69] Can't ignore you, can't ignore you, ah
[02:17.87] Body-ody, my soul and that, I'm outta control, I can't
[02:21.86] I adore you, I adore you, I do
[02:26.07] (I do, I do, I do, I do)
[02:30.06] (I do, I do, I do, I do)
[02:33.92] Body-ody, my soul and that, I'm outta control, I can't
[02:37.91] I adore you
[02:40.55] 'Cause you know, baby, I adore you, I adore you
[02:45.54] Can't ignore you, can't ignore you, ah
[02:49.88] Body-ody, my soul and that, I'm outta control, I can't
[02:53.85] I adore you, I adore you, I do
[02:58.19] Plenty more, plenty more (pleanty more, ay)
[02:59.92] But you're my hope for the night, oh
[03:02.28] Gimme more control (control)
[03:04.43] Slow down for the night, oh
[03:06.58] Lemme know, lemme know (lemme know)
[03:08.45] That you're down for the vibe
[03:10.23] Are you down for the vibe? Oh
[03:12.17] We don't say bye-bye
[03:14.27] Le-le-le, le-le-le, yeah, yeah
[03:17.95] Le-le-le, le-le-le, yeah, yeah
[03:21.96] Le-le-le, le-le-le, yeah
[03:25.36] Baby, I adore you, I adore you, I do
[03:30.05] `// 如果没有歌词，可以留空或写这个
            },
        ];
            
            
        // ===========================================

        const musicContainer = document.getElementById('music-container');
        const playBtn = document.getElementById('play');
        const prevBtn = document.getElementById('prev');
        const nextBtn = document.getElementById('next');
        const audio = document.getElementById('audio');
        const progress = document.getElementById('progress');
        const progressContainer = document.getElementById('progress-container');
        const title = document.getElementById('title');
        const artist = document.getElementById('artist');
        const cover = document.getElementById('cover');
        const playlistView = document.getElementById('playlist-view');
        
        // 歌词相关 DOM
        const lyricsBox = document.getElementById('lyrics-box');
        const lyricsList = document.getElementById('lyrics-list');

        let songIndex = 0;
        let lyricTimeStamps = []; // 存储当前歌曲的时间标签和行号

        // 初始化
        loadSong(songs[songIndex]);
        renderPlaylist();

        function loadSong(song) {
            title.innerText = song.title;
            artist.innerText = song.artist;
            audio.src = song.path;
            
            if(song.cover) {
                cover.src = song.cover;
            } else {
                cover.src = "https://via.placeholder.com/150?text=Music";
            }

            // 加载歌词
            parseAndRenderLyrics(song.lrc);
            updatePlaylistActive();
        }

        // --- 核心：歌词解析与渲染 ---
        function parseAndRenderLyrics(lrcString) {
            lyricsList.innerHTML = ""; // 清空旧歌词
            lyricTimeStamps = [];      // 重置时间表

            if (!lrcString) {
                const li = document.createElement('li');
                li.innerText = "暂无歌词";
                lyricsList.appendChild(li);
                return;
            }

            // 按行分割
            const lines = lrcString.split('\n');
            // 正则匹配 [00:00.00] 或 [00:00]
            const timeReg = /\[(\d{2}):(\d{2})(?:\.(\d{2,3}))?\]/;

            lines.forEach((line, index) => {
                const match = timeReg.exec(line);
                if (match) {
                    // 转换时间为秒： 分 * 60 + 秒
                    const min = parseInt(match[1]);
                    const sec = parseInt(match[2]);
                    const ms = match[3] ? parseFloat("0." + match[3]) : 0;
                    const time = min * 60 + sec + ms;
                    
                    // 获取歌词文本（去掉时间标签）
                    const text = line.replace(timeReg, '').trim();

                    // 存入数组
                    lyricTimeStamps.push({ time, index: lyricTimeStamps.length });

                    // 创建 DOM
                    const li = document.createElement('li');
                    li.innerText = text; // 如果 text 为空也留个 li 占位
                    lyricsList.appendChild(li);
                }
            });
        }

        // --- 核心：歌词同步逻辑 ---
        function syncLyrics() {
            const currentTime = audio.currentTime;
            
            // 找到当前时间对应的歌词行
            // 算法：找到最后一个 time <= currentTime 的元素
            let activeIndex = -1;
            for (let i = 0; i < lyricTimeStamps.length; i++) {
                if (currentTime >= lyricTimeStamps[i].time) {
                    activeIndex = i;
                } else {
                    break; // 因为时间是顺序的，一旦大于就不用往后找了
                }
            }

            // 只有当行号变化时才操作 DOM，提升性能
            const activeLi = lyricsList.children[activeIndex];
            const currentActive = lyricsList.querySelector('.active');

            if (activeLi && activeLi !== currentActive) {
                // 移除旧高亮
                if (currentActive) currentActive.classList.remove('active');
                // 添加新高亮
                activeLi.classList.add('active');

                // 滚动算法：让高亮行居中
                // 容器中心点 = 容器高度 / 2
                // 滚动距离 = (当前行offsetTop - 容器高度 / 2) + (当前行高度 / 2)
                const scrollOffset = activeLi.offsetTop - (lyricsBox.clientHeight / 2) + (activeLi.clientHeight / 2);
                
                lyricsBox.scrollTo({
                    top: scrollOffset,
                    behavior: 'smooth' 
                });
            }
        }

        // 播放控制
        function playSong() {
            musicContainer.classList.add('play');
            playBtn.querySelector('i').classList.remove('fa-play');
            playBtn.querySelector('i').classList.add('fa-pause');
            audio.play();
        }

        function pauseSong() {
            musicContainer.classList.remove('play');
            playBtn.querySelector('i').classList.add('fa-play');
            playBtn.querySelector('i').classList.remove('fa-pause');
            audio.pause();
        }

        function prevSong() {
            songIndex--;
            if (songIndex < 0) songIndex = songs.length - 1;
            loadSong(songs[songIndex]);
            playSong();
        }

        function nextSong() {
            songIndex++;
            if (songIndex > songs.length - 1) songIndex = 0;
            loadSong(songs[songIndex]);
            playSong();
        }

        function updateProgress(e) {
            const { duration, currentTime } = e.srcElement;
            const progressPercent = (currentTime / duration) * 100;
            progress.style.width = `${progressPercent}%`;
            
            // 调用歌词同步
            syncLyrics();
        }

        function setProgress(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audio.duration;
            audio.currentTime = (clickX / width) * duration;
        }

        function renderPlaylist() {
            playlistView.innerHTML = '';
            songs.forEach((song, index) => {
                const item = document.createElement('p');
                item.innerText = `${index + 1}. ${song.title} - ${song.artist}`;
                item.addEventListener('click', () => {
                    songIndex = index;
                    loadSong(songs[songIndex]);
                    playSong();
                });
                playlistView.appendChild(item);
            });
            updatePlaylistActive();
        }
        
        function updatePlaylistActive() {
            const items = playlistView.querySelectorAll('p');
            items.forEach((item, index) => {
                if(index === songIndex) item.classList.add('active');
                else item.classList.remove('active');
            });
        }

        // 事件监听
        playBtn.addEventListener('click', () => {
            const isPlaying = musicContainer.classList.contains('play');
            if (isPlaying) pauseSong();
            else playSong();
        });

        prevBtn.addEventListener('click', prevSong);
        nextBtn.addEventListener('click', nextSong);
        audio.addEventListener('timeupdate', updateProgress);
        progressContainer.addEventListener('click', setProgress);
        audio.addEventListener('ended', nextSong);

    </script>
</body>
</html>